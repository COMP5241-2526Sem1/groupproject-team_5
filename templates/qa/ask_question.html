{% extends "base.html" %}

{% block title %}Ask a Question - {{ course.name }}{% endblock %}

{% block content %}
<div class="container mt-3">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow" style="margin-bottom: 4rem;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div class="d-flex justify-content-center align-items-center gap-3 mb-2">
                            <i class="bi bi-question-circle text-primary" style="font-size:2.5rem;"></i>
                            <h3 class="mb-0">Ask a Question in "{{ course.name }}"</h3>
                        </div>
                        <p class="text-muted mt-2">Describe your question clearly so others can help you effectively.</p>
                    </div>

                    <form method="POST">
                        <div class="form-group">
                            <label for="title">Question Title <span class="text-danger">*</span></label>
                            <input type="text" 
                                   class="form-control" 
                                   id="title" 
                                   name="title" 
                                   placeholder="Enter question title" 
                                   required
                                   value="{{ request.form.get('title', '') }}">
                            <small class="form-text text-muted">
                                Please provide a concise and clear title for your question
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="content">Question Details <span class="text-danger">*</span></label>
                            <textarea class="form-control" 
                                      id="content" 
                                      name="content" 
                                      rows="8" 
                                      placeholder="Please describe your question in detail..." 
                                      required>{{ request.form.get('content', '') }}</textarea>
                            <small class="form-text text-muted">
                                Please provide enough background information and specific details to help get better answers.
                            </small>
                        </div>
                        
                        <div class="form-group">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>Question Tips:</strong>
                                <ul class="mb-0 mt-2">
                                    <li>Make sure your question is related to the course content</li>
                                    <li>Search for existing questions to avoid duplicates</li>
                                    <li>Use clear language and proper formatting</li>
                                    <li>If your question is resolved, please provide feedback</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-paper-plane"></i> Post Question
                            </button>
                            <a href="{{ url_for('qa.course_qa_list', course_id=course.id) }}" 
                               class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // 自动保存草稿到localStorage
    const titleInput = document.getElementById('title');
    const contentTextarea = document.getElementById('content');
    const courseId = parseInt('{{ course.id }}');
    
    function saveDraft() {
        const draft = {
            title: titleInput.value,
            content: contentTextarea.value,
            timestamp: new Date().getTime()
        };
        localStorage.setItem(`qa_draft_${courseId}`, JSON.stringify(draft));
    }
    
    function loadDraft() {
        const draftKey = `qa_draft_${courseId}`;
        const draft = localStorage.getItem(draftKey);
        if (draft) {
            const draftData = JSON.parse(draft);
            // 只在字段为空时加载草稿
            if (!titleInput.value && draftData.title) {
                titleInput.value = draftData.title;
            }
            if (!contentTextarea.value && draftData.content) {
                contentTextarea.value = draftData.content;
            }
        }
    }
    
    // 页面加载时尝试加载草稿
    document.addEventListener('DOMContentLoaded', loadDraft);
    
    // 输入时保存草稿
    titleInput.addEventListener('input', saveDraft);
    contentTextarea.addEventListener('input', saveDraft);
    
    // 表单提交时清除草稿
    document.querySelector('form').addEventListener('submit', function() {
        localStorage.removeItem(`qa_draft_${courseId}`);
    });
</script>
{% endblock %}
