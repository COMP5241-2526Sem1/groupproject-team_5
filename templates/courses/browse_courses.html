{% extends "base.html" %}

{% block title %}Browse Courses - Classroom Interaction Platform{% endblock %}

{% block content %}
<style>
.course-card {
    transition: all 0.3s ease;
    border: none;
    border-radius: 15px;
    overflow: hidden;
    background: #ffffff; /* 外层白色框 */
    box-shadow: 0 6px 18px rgba(12,45,80,0.04);
}

.course-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.08);
}

/* 内部小模块，带自身渐变色 */
.course-inner {
  margin: 20px; /* 增大留白，让内部彩色模块周围显示更多白色边框 */
    border-radius: 12px;
    padding: 18px;
    box-sizing: border-box;
    height: 260px; /* 固定高度，保持所有模块一致 */
    overflow: hidden;
    position: relative; /* 允许内部绝对定位，用于固定底部元信息 */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: #153d5a; /* 深灰色文本，适配渐变 */
    transition: all 0.25s ease;
}

/* 多彩渐变背景 - 应用于内部小模块 */
.course-inner.course-color-1 { background: linear-gradient(135deg, #f0f9f0 0%, #e8f5e8 50%, #e0f0e0 100%); }
.course-inner.course-color-2 { background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 50%, #ffd9d9 100%); }
.course-inner.course-color-3 { background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 50%, #ddeeff 100%); }
.course-inner.course-color-4 { background: linear-gradient(135deg, #fffef0 0%, #fffae6 50%, #fff6dc 100%); }
.course-inner.course-color-5 { background: linear-gradient(135deg, #faf5ff 0%, #f5ebff 50%, #f0e1ff 100%); }
.course-inner.course-color-6 { background: linear-gradient(135deg, #fff8f0 0%, #fff2e6 50%, #ffebdc 100%); }

/* 悬停时的内部渐变变化 */
.course-inner.course-color-1:hover { filter: brightness(0.98); }
.course-inner.course-color-2:hover { filter: brightness(0.98); }
.course-inner.course-color-3:hover { filter: brightness(0.98); }
.course-inner.course-color-4:hover { filter: brightness(0.98); }
.course-inner.course-color-5:hover { filter: brightness(0.98); }
</style>

<style>
/* Ensure footer area keeps comfortable white padding */
.course-card .card-footer { padding: 14px; }

.course-inner.course-color-6:hover { filter: brightness(0.98); }
</style>

<style>
/* 文本截断规则，避免内容撑高模块 */
.course-title-link {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-clamp: 2;
}
.course-desc {
  display: -webkit-box;
  -webkit-line-clamp: 2; /* 减少为 2 行，省略更多描述 */
  -webkit-box-orient: vertical;
  overflow: hidden;
  line-clamp: 2;
}
@media (max-width: 576px) {
  .course-inner { height: auto; }
}
</style>

<style>
/* 预留空间并固定底部元信息位置 */
.course-inner .card-body { padding-bottom: 72px; }
.course-meta-row {
  position: absolute;
  left: 18px;
  right: 18px;
  bottom: 18px;
}
@media (max-width:576px){
  .course-inner .card-body { padding-bottom: 14px; }
  .course-meta-row { position: static; margin-top: 12px; }
}
</style>

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-search"></i> Browse Courses</h2>
    <a href="{{ url_for('courses.list_courses') }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-left"></i> My Courses
    </a>
</div>

{% if available_courses %}
    <div class="row">
        {% for course in available_courses %}
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 course-card">
            <div class="course-inner course-color-{{ (loop.index - 1) % 6 + 1 }}">
              <div class="card-body p-0">
                <h5 class="card-title mb-3" style="color: inherit;">
                  <a class="course-title-link text-decoration-none" href="{{ url_for('courses.course_detail', course_id=course.id) }}">{{ course.name }}</a>
                </h5>
                {# 移除顶部重复元信息，底部统一显示以保证对齐 #}
                {% if course.description %}
                  <p class="card-text mt-3 course-desc" style="color: #5a6570;">{{ course.description[:200] }}{% if course.description|length > 200 %}...{% endif %}</p>
                {% endif %}
                <div class="row text-center mt-4 course-meta-row">
                  <div class="col-6">
                    <i class="bi bi-person-circle" style="font-size: 1.1rem; color: rgba(21,61,90,0.9); margin-bottom: 6px; display: block;"></i>
                    <div>
                      <small class="d-block" style="white-space: nowrap; font-size: 0.75rem; color: rgba(21,61,90,0.7);">Instructor</small>
                      <strong style="font-size: 0.85rem; color: rgba(21,61,90,0.95);">{{ course.instructor.name }}</strong>
                    </div>
                  </div>
                  <div class="col-6">
                    <i class="bi bi-calendar-event" style="font-size: 1.1rem; color: rgba(21,61,90,0.9); margin-bottom: 6px; display: block;"></i>
                    <div>
                      <small class="d-block" style="white-space: nowrap; font-size: 0.75rem; color: rgba(21,61,90,0.7);">Semester</small>
                      <strong style="font-size: 0.85rem; color: rgba(21,61,90,0.95);">{{ course.semester }}</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-footer bg-transparent">
              <form method="POST" action="{{ url_for('courses.enroll_course', course_id=course.id) }}">
                <div class="d-grid">
                  <button type="submit" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Enroll Course
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="text-center py-5">
        <i class="bi bi-book display-1 text-muted"></i>
        <h3 class="text-muted mt-3">There are no available courses</h3>
        <p class="text-muted">No new courses available for enrollment. Please check your enrolled courses.</p>
        <a href="{{ url_for('courses.list_courses') }}" class="btn btn-primary">
            <i class="bi bi-book"></i> View My Courses
        </a>
    </div>
{% endif %}
{% endblock %}
